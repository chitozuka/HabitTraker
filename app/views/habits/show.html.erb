<h3 class="display-5"><%= @habit.name %></h3>

<% flash.each do |key, value| %>
  <%
    alert_class = "alert-success"
    if key == 'alert' then
      alert_class = "alert-danger"
    end
  %>
  <div class="alert <%= alert_class %>" role="alert">
    <%= value %>
  </div>
<% end %>

<!-- 進捗フォーム -->
<%= form_with(model: @progress, url: habit_progresses_path(@habit)) do |form| %>
  <div class="field">
    <%= form.label :date %>
    <%= form.date_field :date %>
  </div>

  <div class="form-check">
    <%= form.label :completed, class: 'form-check-input' %>
    <%= form.check_box :completed, class: 'form-check-label' %>
  </div>

  <div class="field">
    <%= form.label :memo, class: 'form-label' %>
    <%= form.text_area :memo, class: 'form-control' %>
  </div>

  <div class="actions">
    <%= form.submit "Create Progress", class: 'btn btn-primary' %>
  </div>
<% end %>

<h3>Progress:</h3>
<table class="table" style="width: 360px">
  <thead>
    <tr>
      <th style="width: 140px">Date</th>
      <th>Completed</th>
      <th>Memo</th>
      <th style="width: 60px" colspan="2">Delete</th>
    </tr>
  </thread>
  <% (@start_date..@end_date).each do |date| %>
    <tr>
      <td><%= date %>(<%= week_days[date.wday] %>)</td>
      <% if @progress_records[date] %>
        <% if @progress_records[date]&.completed %>
          <td>OK</td>
        <% else %>
          <td>NG</td>
        <% end %>
      <% else %>
        <td>--</td>
      <% end %>
      <td>
        <% if @progress_records[date] %>
          <%= @progress_records[date].memo %>
        <% end %>
      </td>

      <% if @progress_records[date] %>
        <td colspan="2">
          <%= button_to habit_progress_path(@habit, date: date), method: :delete, data: { confirm: "Are you sure you want to delete this progress?" }, class: 'btn btn-secondary' do %>
            Delete
          <% end %>
        </td>
      <% else %>
        <td>
          <%= form_with(model: @progress, url: habit_progresses_path(@habit)) do |form| %>
            <%= form.hidden_field :date, value: date %>
            <%= form.hidden_field :completed, value: true %>
            <%= form.submit "OK", class: 'btn btn-primary' %>
          <% end %>
        </td>
        <td>
          <%= form_with(model: @progress, url: habit_progresses_path(@habit)) do |form| %>
            <%= form.hidden_field :date, value: date %>
            <%= form.hidden_field :completed, value: false %>
            <%= form.submit "NG", class: 'btn btn-danger' %>
          <% end %>
        </td>
      <% end %>
    </tr>
  <% end %>
</table>
